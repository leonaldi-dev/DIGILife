<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Calculator - Fun Edition</title>
    <!-- Memuat Font Poppins dan Fredoka One -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS DENGAN ANIMASI FUN & KIDS-FRIENDLY */
        
        /* Tema Warna */
        :root {
            --op-green: #27ae60; 
            --op-green-shadow: #1e8449;
            --op-blue-gray: #34495e;
            --op-blue-gray-shadow: #263849;
            --op-orange: #e67e22;
            --op-orange-shadow: #d35400;
            --op-purple: #9b59b6;
            --op-purple-shadow: #8e44ad;
            --op-red: #e74c3c;
            --op-red-shadow: #c0392b;
            --op-blue: #3498db;
            --op-blue-shadow: #2980b9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .calculator-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 900px;
            width: 100%;
        }

        .calculator {
            background: #2c3e50;
            border-radius: 25px; 
            padding: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.1); 
            max-width: 400px;
            width: 100%;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .display {
            background: #1a252f;
            border-radius: 15px; 
            padding: 20px;
            margin-bottom: 20px;
            text-align: right;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5); 
            overflow: hidden; 
        }

        .current-operation {
            color: #95a5a6;
            font-family: 'Fredoka One', cursive;
            font-size: 1.2rem;
            min-height: 24px;
            word-wrap: break-word;
            transition: color 0.3s;
        }
        
        /* Style untuk pesan lucu/fun fact */
        .fun-message {
            color: #ffcc00; /* Kuning cerah */
            font-family: 'Fredoka One', cursive; 
            font-size: 1.1rem;
            animation: slideIn 0.3s ease-out;
            min-height: 24px;
        }
        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .current-value {
            color: #ecf0f1;
            font-family: 'Fredoka One', cursive;
            font-size: 2.8rem;
            font-weight: bold;
            word-wrap: break-word;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        button {
            background: var(--op-blue-gray);
            border: none;
            border-radius: 12px;
            color: #ecf0f1;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 15px;
            cursor: pointer;
            transition: all 0.1s ease-out; 
            min-height: 70px;
            box-shadow: 0 5px var(--op-blue-gray-shadow); 
            line-height: 1; 
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button:hover {
            background: #4a6b8a;
            transform: translateY(-4px);
            box-shadow: 0 9px var(--op-blue-gray-shadow);
        }

        button:active {
            transform: translateY(2px) scale(0.95);
            box-shadow: 0 3px var(--op-blue-gray-shadow);
        }
        
        /* === SKEMA WARNA TOMBOL KHUSUS === */

        /* Tombol Clear */
        .clear {
            background: var(--op-red);
            box-shadow: 0 5px var(--op-red-shadow);
        }
        .clear:hover { background: #c0392b; box-shadow: 0 9px var(--op-red-shadow); }
        .clear:active { box-shadow: 0 3px var(--op-red-shadow); }
        
        /* Tombol Memory */
        .memory {
            background: var(--op-purple);
            box-shadow: 0 5px var(--op-purple-shadow);
            font-size: 1.2rem;
        }
        .memory:hover { background: #8e44ad; box-shadow: 0 9px var(--op-purple-shadow); }
        .memory:active { box-shadow: 0 3px var(--op-purple-shadow); }
        
        /* Tombol Operator */
        .operator {
            background: var(--op-orange);
            box-shadow: 0 5px var(--op-orange-shadow);
        }
        .operator:hover { background: #f39c12; box-shadow: 0 9px var(--op-orange-shadow); }
        .operator:active { box-shadow: 0 3px var(--op-orange-shadow); }
        
        /* Tombol Fungsi Khusus */
        .function {
            background: var(--op-blue);
            box-shadow: 0 5px var(--op-blue-shadow);
            font-size: 1.3rem;
        }
        .function:hover { background: #2980b9; box-shadow: 0 9px var(--op-blue-shadow); }
        .function:active { box-shadow: 0 3px var(--op-blue-shadow); }
        
        /* Tombol Equals */
        .equals {
            background: var(--op-green);
            box-shadow: 0 5px var(--op-green-shadow);
        }
        .equals:hover { background: #219a52; box-shadow: 0 9px var(--op-green-shadow); }
        .equals:active { box-shadow: 0 3px var(--op-green-shadow); }

        /* === ANIMASI HASIL (CALCULATE) === */
        .result-glow {
            animation: resultGlow 0.5s ease-out;
        }

        @keyframes resultGlow {
            0% { box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5); transform: scale(1); }
            50% { box-shadow: inset 0 0 20px var(--op-green), 0 0 10px var(--op-green); transform: scale(1.02); }
            100% { box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5); transform: scale(1); }
        }

        /* Animasi Error */
        .error-shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .double {
            grid-column: span 2;
        }

        /* Panel History */
        .history-panel {
            background: #2c3e50;
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.1);
            max-width: 400px;
            width: 100%;
            color: #ecf0f1;
            display: none;
        }

        .history-panel h3 {
            font-family: 'Fredoka One', cursive;
            margin-bottom: 15px;
            text-align: center;
            color: #ffcc00;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: #1a252f;
            border-radius: 10px;
        }

        .history-item {
            padding: 8px;
            border-bottom: 1px solid #34495e;
            font-family: 'Poppins', sans-serif;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .clear-history {
            background: #d35400;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            margin-top: 10px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            width: 100%;
        }

        .toggle-history {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            width: 100%;
        }

        /* Layout untuk desktop */
        @media (min-width: 768px) {
            .calculator-container {
                flex-direction: row;
                justify-content: center;
            }
            
            .history-panel {
                display: block;
            }
        }

        @media (max-width: 480px) {
            .calculator {
                padding: 15px;
            }
            button {
                padding: 15px;
                font-size: 1.3rem;
                min-height: 60px;
            }
            .current-value {
                font-size: 2rem;
            }
            
            .history-panel {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="calculator" id="calc">
            <div class="display">
                <!-- Tempat untuk Teks Operasi / Pesan Lucu -->
                <div class="current-operation" id="operation"></div> 
                <!-- Tempat untuk Nilai yang Sedang Diketik/Hasil -->
                <div class="current-value" id="display">0</div>
            </div>
            <div class="buttons">
                <!-- Baris 1: Memory Functions -->
                <button class="memory" onclick="memoryClear()">MC</button>
                <button class="memory" onclick="memoryRecall()">MR</button>
                <button class="memory" onclick="memoryAdd()">M+</button>
                <button class="memory" onclick="memorySubtract()">M-</button>
                
                <!-- Baris 2: Clear Functions -->
                <button class="clear" onclick="clearCalculator()">C</button>
                <button class="clear" onclick="clearEntry()">CE</button>
                <button class="function" onclick="backspace()">‚å´</button>
                <button class="function" onclick="toggleSign()">+/-</button>
                
                <!-- Baris 3: Fungsi Khusus dan Operator -->
                <button class="function" onclick="calculatePercentage()">%</button>
                <button class="function" onclick="calculateSquareRoot()">‚àö</button>
                <button class="operator" onclick="appendOperator('/')">/</button>
                <button class="operator" onclick="appendOperator('*')">√ó</button>
                
                <!-- Baris 4: Angka 7-9 dan Operator -->
                <button onclick="appendNumber('7')">7</button>
                <button onclick="appendNumber('8')">8</button>
                <button onclick="appendNumber('9')">9</button>
                <button class="operator" onclick="appendOperator('-')">-</button>
                
                <!-- Baris 5: Angka 4-6 dan Operator -->
                <button onclick="appendNumber('4')">4</button>
                <button onclick="appendNumber('5')">5</button>
                <button onclick="appendNumber('6')">6</button>
                <button class="operator" onclick="appendOperator('+')">+</button>
                
                <!-- Baris 6: Angka 1-3 dan Equals -->
                <button onclick="appendNumber('1')">1</button>
                <button onclick="appendNumber('2')">2</button>
                <button onclick="appendNumber('3')">3</button>
                <button class="equals" onclick="calculate()" rowspan="2">=</button>
                
                <!-- Baris 7: Angka 0, Desimal, dan History -->
                <button class="double" onclick="appendNumber('0')">0</button>
                <button onclick="appendDecimal()">.</button>
                <button class="function" onclick="toggleHistory()">Hist</button>
            </div>
        </div>
        
        <div class="history-panel" id="historyPanel">
            <h3>Riwayat Perhitungan</h3>
            <div class="history-list" id="historyList">
                <!-- Riwayat akan ditampilkan di sini -->
            </div>
            <button class="clear-history" onclick="clearHistory()">Hapus Riwayat</button>
        </div>
    </div>

    <script>
        // Daftar pesan kejutan lucu/pintar
        const funMessages = {
            // Pesan saat hasil adalah bilangan bulat (integer)
            integer: [
                "‚ú® BILANGAN BULAT SEMPURNA! Hasilnya rapi sekali.",
                "Angka ini sangat bersih. Tidak ada remah-remah di belakang koma.",
                "üéâ Hasilnya bulat, seperti donat yang enak!",
                "Bravo! Itu jawaban yang sah!"
            ],
            // Pesan saat hasil memiliki desimal/koma
            decimal: [
                "üßê Hasilnya agak berkoma. Dunia ini tidak selalu sempurna, kan?",
                "Jangan panik dengan komanya! Itu hanya angka yang sedang bersembunyi.",
                "Hmm, sepertinya kita butuh pembulatan. Tapi kita biarkan saja dia apa adanya.",
                "Mantap! Tetap hitungan yang valid!"
            ],
            // Pesan untuk hasil yang sangat besar (>= 100000)
            large: [
                "ü§Ø WOW! Angka sebesar ini bisa membuat Anda kaya!",
                "üö® Hasilnya sudah mencapai orbit! Kita butuh roket untuk membacanya.",
                "Penting! Angka ini layak mendapat tepuk tangan meriah. üëè"
            ],
            // Pesan untuk hasil nol
            zero: [
                "0Ô∏è‚É£ Hasil nol. Tapi di dunia ini, nol juga penting lho!",
                "Mulai dari nol lagi, ya? Tidak masalah, nol itu keren.",
                "Nol. Sempurna, tapi sedikit membosankan. Coba lagi!"
            ],
            // Pesan untuk error/pembagian nol
            error: [
                "‚ùå TIDAK BISA DIBAGI DENGAN NOL! Coba lagi dengan angka lain.",
                "üö® ERROR! Angka Anda mencoba melarikan diri dari pembagian nol.",
                "Waduh! Ada lubang hitam di hitungan Anda. Tekan C."
            ],
            // Pesan khusus untuk penjumlahan
            addition: [
                "‚ûï Penjumlahan yang sempurna!",
                "Tambah-tambahan yang menyenangkan!",
                "Hasil penjumlahan yang cantik!",
                "Wow, angka-angka ini cocok bertemu!"
            ],
            // Pesan khusus untuk pengurangan
            subtraction: [
                "‚ûñ Pengurangan yang tepat!",
                "Mengurangi dengan percaya diri!",
                "Hasil pengurangan yang akurat!"
            ],
            // Pesan khusus untuk perkalian
            multiplication: [
                "‚úñÔ∏è Perkalian yang hebat!",
                "Wow, angka-angka ini berkembang pesat!",
                "Hasil perkalian yang mengesankan!"
            ],
            // Pesan khusus untuk pembagian
            division: [
                "‚ûó Pembagian yang sempurna!",
                "Membagi dengan presisi!",
                "Hasil pembagian yang tepat!"
            ],
            // Pesan untuk akar kuadrat
            squareRoot: [
                "‚àö Akar kuadrat yang elegan!",
                "Mengambil akar dengan percaya diri!",
                "Hasil akar kuadrat yang sempurna!"
            ]
        };

        class Calculator {
            constructor() {
                // State Awal Kalkulator
                this.currentValue = '0';
                this.previousValue = '';
                this.operator = '';
                this.waitingForNewValue = false; // Flag untuk menunggu input angka kedua
                this.errorMode = false;
                this.clearMessage = false; // Flag untuk menghapus pesan lucu
                this.memory = 0;
                this.history = [];
                
                // Elemen DOM
                this.displayElement = document.getElementById('display');
                this.operationElement = document.getElementById('operation');
                this.displayArea = document.querySelector('.display'); 
                this.historyList = document.getElementById('historyList');
                this.historyPanel = document.getElementById('historyPanel');
                
                // Load settings dari localStorage
                this.loadSettings();
            }

            // --- DISPLAY & ANIMASI ---

            updateDisplay() {
                 if (this.errorMode) {
                    this.displayElement.textContent = "ERROR!";
                    return;
                }
                
                // Tampilkan angka dengan format lokal untuk angka besar
                this.displayElement.textContent = this.formatNumber(this.currentValue);
                
                // Jika sedang menampilkan pesan lucu, jangan tampilkan operasi di baris atas
                if (this.clearMessage) return;

                let operationText = '';
                if (this.previousValue !== '') {
                    const displayOperator = this.operator === '*' ? '√ó' : this.operator; 
                    operationText = `${this.formatNumber(this.previousValue)} ${displayOperator || ''}`;
                }
                
                // Hapus kelas fun-message jika sedang menampilkan operasi normal
                this.operationElement.classList.remove('fun-message');
                this.operationElement.textContent = operationText;
            }

            // Fungsi untuk memformat angka dengan koma sebagai pemisah ribuan
            formatNumber(inputNum) {
                // Jika input adalah string kosong atau null
                if (!inputNum && inputNum !== 0) return '0';
                
                const numString = String(inputNum); 

                // Angka negatif
                const isNegative = numString.startsWith('-');
                let num = isNegative ? numString.substring(1) : numString;

                // Pisahkan bagian integer dan desimal
                const [integerPart, decimalPart] = num.split('.');

                // Format bagian integer dengan pemisah ribuan
                let formattedInteger;
                try {
                    formattedInteger = parseFloat(integerPart).toLocaleString('id-ID', { maximumFractionDigits: 0 });
                } catch (e) {
                    formattedInteger = integerPart;
                }

                // Gabungkan kembali
                let result;
                if (decimalPart !== undefined) {
                    result = `${formattedInteger}.${decimalPart}`;
                } else {
                    result = formattedInteger;
                }

                // Tambahkan kembali tanda negatif jika ada
                return isNegative ? `-${result}` : result;
            }

            animateResult() {
                this.displayArea.classList.remove('result-glow');
                void this.displayArea.offsetWidth; 
                this.displayArea.classList.add('result-glow');
            }
            
            animateError() {
                this.displayArea.classList.remove('error-shake');
                void this.displayArea.offsetWidth; 
                this.displayArea.classList.add('error-shake');
            }
            
            // --- LOGIKA PESAN LUCU ---

            showFunMessage(result, isError = false, operator = '') {
                let category;
                
                if (isError) {
                    category = 'error';
                } else if (result === 0) {
                    category = 'zero';
                } else if (operator === '+') {
                    category = 'addition';
                } else if (operator === '-') {
                    category = 'subtraction';
                } else if (operator === '*') {
                    category = 'multiplication';
                } else if (operator === '/') {
                    category = 'division';
                } else if (operator === '‚àö') {
                    category = 'squareRoot';
                } else {
                    const absResult = Math.abs(result);
                    if (Number.isInteger(absResult) && String(absResult).length < 7) {
                        category = 'integer';
                    } else if (absResult >= 100000) {
                        category = 'large';
                    } else if (!Number.isInteger(result) && String(result).includes('.')) {
                        category = 'decimal';
                    } else {
                        return; 
                    }
                }
                
                const messages = funMessages[category];
                const message = messages[Math.floor(Math.random() * messages.length)];
                
                this.operationElement.textContent = message;
                this.operationElement.classList.add('fun-message');
                this.clearMessage = true;
            }

            // --- FUNGSI KALKULATOR UTAMA ---

            appendNumber(number) {
                 if (this.errorMode) this.clearCalculator();

                // Hapus pesan lucu saat mulai mengetik angka baru
                if (this.clearMessage && !this.waitingForNewValue) {
                    this.clearMessage = false;
                    this.operationElement.textContent = '';
                    this.operationElement.classList.remove('fun-message');
                }

                if (this.waitingForNewValue) {
                    this.currentValue = number;
                    this.waitingForNewValue = false;
                } else {
                    // Batasi panjang angka untuk menghindari overflow display
                    if (this.currentValue.replace('-', '').replace('.', '').length < 15) {
                        this.currentValue = this.currentValue === '0' ? number : this.currentValue + number;
                    } else {
                        this.showMessage("üö´ Angka terlalu panjang!", true);
                    }
                }
                this.updateDisplay();
            }
            
            appendDecimal() {
                if (this.errorMode) this.clearCalculator();
                if (this.currentValue.indexOf('.') === -1) {
                    if (this.waitingForNewValue) {
                        this.currentValue = '0.';
                        this.waitingForNewValue = false;
                    } else {
                        this.currentValue += '.';
                    }
                }
                this.updateDisplay();
            }

            appendOperator(nextOperator) {
                 if (this.errorMode) this.clearCalculator();
                this.clearMessage = false;

                const inputValue = parseFloat(this.currentValue);

                if (this.previousValue === '') {
                    this.previousValue = inputValue;
                } else if (this.operator) {
                    const result = this.performCalculation();
                    
                    if (result === 'Error') {
                        this.handleError();
                        return;
                    }
                    this.currentValue = String(result);
                    this.previousValue = result;
                }

                this.waitingForNewValue = true;
                this.operator = nextOperator;
                this.updateDisplay();
            }

            // Fungsi untuk mengubah tanda (+/-)
            toggleSign() {
                if (this.errorMode || this.currentValue === '0') return;

                // Jika sedang menunggu input angka baru, terapkan ke previousValue dulu
                if (this.waitingForNewValue && this.previousValue !== '') {
                    this.previousValue = this.previousValue * -1;
                    this.updateDisplay();
                } 
                // Jika sedang mengetik angka, terapkan ke currentValue
                else {
                    const currentValueNum = parseFloat(this.currentValue);
                    if (!isNaN(currentValueNum) && currentValueNum !== 0) {
                        this.currentValue = String(currentValueNum * -1);
                        this.updateDisplay();
                    }
                }
            }
            
            // Fungsi untuk menghapus karakter terakhir
            backspace() {
                if (this.errorMode || this.waitingForNewValue) return;
                
                if (this.currentValue.length === 1 || 
                    (this.currentValue.length === 2 && this.currentValue.startsWith('-'))) {
                    this.currentValue = '0';
                } else {
                    this.currentValue = this.currentValue.slice(0, -1);
                }
                this.updateDisplay();
            }
            
            // Fungsi untuk menghitung persentase
            calculatePercentage() {
                if (this.errorMode) return;
                const value = parseFloat(this.currentValue);
                this.currentValue = String(value / 100);
                this.updateDisplay();
            }
            
            // Fungsi untuk menghitung akar kuadrat
            calculateSquareRoot() {
                if (this.errorMode) return;
                const value = parseFloat(this.currentValue);
                
                if (value < 0) {
                    this.showMessage("‚ùå Tidak bisa menghitung akar kuadrat dari angka negatif!", true);
                    this.animateError();
                    return;
                }
                
                const result = Math.sqrt(value);
                this.currentValue = String(result);
                this.showFunMessage(result, false, '‚àö');
                this.animateResult();
                this.addToHistory(`‚àö${value} = ${result}`);
                this.updateDisplay();
            }

            performCalculation() {
                const prev = parseFloat(this.previousValue);
                const current = parseFloat(this.currentValue);
                
                if (isNaN(prev) || isNaN(current)) return current; 

                let result;
                switch (this.operator) {
                    case '+': result = prev + current; break;
                    case '-': result = prev - current; break;
                    case '*': result = prev * current; break;
                    case '/': 
                        if (current === 0) {
                            return 'Error'; 
                        }
                        result = prev / current; 
                        break;
                    default: return current;
                }
                // Membatasi presisi desimal
                return parseFloat(result.toFixed(10));
            }

            calculate() {
                if (this.errorMode) this.clearCalculator();
                if (this.operator && !this.waitingForNewValue) {
                    const result = this.performCalculation();
                    
                    if (result === 'Error') {
                        this.handleError();
                        return;
                    }
                    
                    this.currentValue = String(result);
                    this.showFunMessage(result, false, this.operator); // Kirim operator untuk pesan khusus
                    this.animateResult(); 
                    
                    // Tambahkan ke riwayat
                    this.addToHistory(`${this.previousValue} ${this.operator} ${parseFloat(this.currentValue)} = ${result}`);

                    this.previousValue = '';
                    this.operator = '';
                    this.waitingForNewValue = true; 
                    this.updateDisplay();
                }
            }
            
            handleError() {
                this.errorMode = true;
                this.currentValue = 'Error';
                this.previousValue = '';
                this.operator = '';
                this.waitingForNewValue = true;
                this.showFunMessage(null, true); 
                this.animateError();
                this.updateDisplay();
            }
            
            // --- FUNGSI MEMORY ---
            
            memoryAdd() {
                if (this.errorMode) return;
                const value = parseFloat(this.currentValue);
                if (!isNaN(value)) {
                    this.memory += value;
                    this.showMessage(`‚úì Ditambahkan ke memory: ${this.formatNumber(value)}`, false);
                    this.saveSettings();
                }
            }
            
            memorySubtract() {
                if (this.errorMode) return;
                const value = parseFloat(this.currentValue);
                if (!isNaN(value)) {
                    this.memory -= value;
                    this.showMessage(`‚úì Dikurangi dari memory: ${this.formatNumber(value)}`, false);
                    this.saveSettings();
                }
            }
            
            memoryRecall() {
                if (this.errorMode) return;
                this.currentValue = String(this.memory);
                this.updateDisplay();
            }
            
            memoryClear() {
                this.memory = 0;
                this.showMessage("‚úì Memory telah dihapus", false);
                this.saveSettings();
            }
            
            // --- FUNGSI RIWAYAT ---
            
            addToHistory(calculation) {
                this.history.unshift(calculation);
                // Batasi riwayat ke 10 item terakhir
                if (this.history.length > 10) {
                    this.history.pop();
                }
                this.updateHistoryDisplay();
                this.saveSettings();
            }
            
            updateHistoryDisplay() {
                this.historyList.innerHTML = '';
                this.history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.textContent = item;
                    this.historyList.appendChild(historyItem);
                });
            }
            
            clearHistory() {
                this.history = [];
                this.updateHistoryDisplay();
                this.saveSettings();
            }
            
            toggleHistory() {
                this.historyPanel.style.display = this.historyPanel.style.display === 'none' ? 'block' : 'none';
            }
            
            // --- FUNGSI SETTINGS & LOCAL STORAGE ---
            
            saveSettings() {
                try {
                    localStorage.setItem('calculatorMemory', this.memory);
                    localStorage.setItem('calculatorHistory', JSON.stringify(this.history));
                } catch (e) {
                    console.log("Tidak bisa menyimpan settings: ", e);
                }
            }
            
            loadSettings() {
                try {
                    const savedMemory = localStorage.getItem('calculatorMemory');
                    if (savedMemory) this.memory = parseFloat(savedMemory);
                    
                    const savedHistory = localStorage.getItem('calculatorHistory');
                    if (savedHistory) this.history = JSON.parse(savedHistory);
                    
                    this.updateHistoryDisplay();
                } catch (e) {
                    console.log("Tidak bisa memuat settings: ", e);
                }
            }
            
            // --- FUNGSI UTILITAS ---
            
            showMessage(message, isError) {
                this.operationElement.textContent = message;
                this.operationElement.classList.add('fun-message');
                this.clearMessage = true;
                
                if (isError) {
                    this.animateError();
                }
                
                this.updateDisplay();
            }

            clearCalculator() {
                this.currentValue = '0';
                this.previousValue = '';
                this.operator = '';
                this.waitingForNewValue = false;
                this.errorMode = false;
                this.clearMessage = false;
                this.updateDisplay();
            }

            clearEntry() {
                if (this.errorMode) this.clearCalculator();
                this.currentValue = '0';
                this.updateDisplay();
            }
        }

        // 1. Buat instance kalkulator
        const calculator = new Calculator();

        // 2. Fungsi Global untuk tombol onclick
        function appendNumber(number) { calculator.appendNumber(number); }
        function appendDecimal() { calculator.appendDecimal(); }
        function appendOperator(operator) { calculator.appendOperator(operator); }
        function calculate() { calculator.calculate(); }
        function clearCalculator() { calculator.clearCalculator(); }
        function clearEntry() { calculator.clearEntry(); }
        function toggleSign() { calculator.toggleSign(); }
        function backspace() { calculator.backspace(); }
        function calculatePercentage() { calculator.calculatePercentage(); }
        function calculateSquareRoot() { calculator.calculateSquareRoot(); }
        function memoryAdd() { calculator.memoryAdd(); }
        function memorySubtract() { calculator.memorySubtract(); }
        function memoryRecall() { calculator.memoryRecall(); }
        function memoryClear() { calculator.memoryClear(); }
        function clearHistory() { calculator.clearHistory(); }
        function toggleHistory() { calculator.toggleHistory(); }

        // 3. Dukungan Keyboard
        document.addEventListener('keydown', (event) => {
            const key = event.key;
            
            if (key >= '0' && key <= '9') {
                appendNumber(key);
            } else if (key === '.') {
                appendDecimal();
            } else if (['+', '-', '*', '/'].includes(key)) {
                event.preventDefault(); 
                appendOperator(key);
            } else if (key === 'Enter' || key === '=') {
                event.preventDefault();
                calculate();
            } else if (key === 'Escape') {
                clearCalculator();
            } else if (key === 'Backspace') {
                backspace(); 
            } else if (key === '%') {
                calculatePercentage();
            }
        });
        
        document.addEventListener('keydown', (event) => {
            if (['+', '-', '*', '/', 'Enter', '='].includes(event.key)) {
                event.preventDefault();
            }
        });
        
        // Sembunyikan panel riwayat di mobile secara default
        window.addEventListener('resize', function() {
            if (window.innerWidth < 768) {
                calculator.historyPanel.style.display = 'none';
            } else {
                calculator.historyPanel.style.display = 'block';
            }
        });
        
        // Inisialisasi tampilan riwayat berdasarkan ukuran layar
        if (window.innerWidth < 768) {
            calculator.historyPanel.style.display = 'none';
        }
    </script>
</body>
</html>

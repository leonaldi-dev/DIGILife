<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Perencana Anggaran & Celengan</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      :root {
        --primary-dark: #1f2a38;
        --secondary-dark: #2c3e50;
        --accent-purple: #9b59b6;
        --accent-green: #2ecc71;
        --accent-yellow: #f1c40f;
        --accent-indigo: #6366f1;
        --text-light: #ecf0f1;
        --button-red: #e74c3c;
        --background-gradient: linear-gradient(
          135deg,
          #1f2a38 0%,
          #2c3e50 100%
        );
      }

      * {
        font-family: "Poppins", sans-serif;
        box-sizing: border-box;
      }

      body {
        background: var(--background-gradient);
        min-height: 100vh;
        width: 100%;
        display: block;
        padding: 0;
        margin: 0;
        overflow-x: hidden;
      }

      .main-app {
        width: 100%;
        max-width: 100%;
        background-color: var(--secondary-dark);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        color: var(--text-light);
        animation: fadeIn 0.6s ease-out;
        margin: 0;
        box-sizing: border-box;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .tab-nav {
        display: flex;
        justify-content: space-around;
        background-color: var(--primary-dark);
        border-radius: 15px 15px 0 0;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .tab-button {
        flex-grow: 1;
        padding: 15px 10px 12px 10px;
        background-color: transparent;
        color: #bdc3c7;
        border: none;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        position: relative;
        border-bottom: 2px solid rgba(236, 240, 241, 0.2);
      }

      .tab-button.active {
        color: var(--accent-yellow);
      }

      .tab-button:hover {
        color: var(--text-light);
      }

      .tab-button::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 50%;
        transform: translateX(-50%);
        height: 4px;
        background-color: var(--accent-yellow);
        width: 0;
        border-radius: 2px;
        transition: width 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      .tab-button:hover::after {
        width: 70%;
      }

      .tab-button.active::after {
        width: 100%;
      }

      .tab-content {
        display: none;
        padding: 20px;
      }

      .tab-content.active {
        display: block;
      }

      .input-style {
        background-color: var(--primary-dark);
        border: 2px solid var(--accent-purple);
        color: var(--text-light);
        transition: all 0.3s ease;
        box-sizing: border-box;
        border-radius: 12px;
        transform: translateZ(0);
        box-shadow: 0 2px 8px rgba(155, 89, 182, 0.1);
      }

      .input-style:focus {
        border-color: var(--accent-green);
        box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.3),
          0 4px 12px rgba(46, 204, 113, 0.2);
        outline: none;
        transform: translateY(-2px) translateZ(0);
      }

      .input-style:hover {
        border-color: var(--accent-indigo);
        transform: translateY(-1px) translateZ(0);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
      }

      .btn-style {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 700;
        box-sizing: border-box;
        transform: translateZ(0);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .btn-style:hover {
        transform: translateY(-3px) translateZ(0);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      }

      .btn-style:active {
        transform: translateY(-1px) translateZ(0);
      }

      .btn-style::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      .btn-style:hover::after {
        width: 300px;
        height: 300px;
      }

      .type-btn {
        flex: 1;
        padding: 12px;
        border: 2px solid var(--accent-purple);
        background: var(--primary-dark);
        color: var(--text-light);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        transform: translateZ(0);
        position: relative;
        overflow: hidden;
      }

      .type-btn:first-child {
        border-radius: 12px 0 0 12px;
        border-right: none;
      }

      .type-btn:last-child {
        border-radius: 0 12px 12px 0;
        border-left: none;
      }

      .type-btn.active {
        background: var(--accent-purple);
        color: white;
        font-weight: 700;
        transform: translateY(-2px) translateZ(0);
        box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
      }

      .type-btn.income.active {
        background: var(--accent-green);
        border-color: var(--accent-green);
        box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
      }

      .type-btn.expense.active {
        background: var(--button-red);
        border-color: var(--button-red);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
      }

      .type-btn:hover:not(.active) {
        background: rgba(155, 89, 182, 0.1);
        box-shadow: 0 4px 8px rgba(155, 89, 182, 0.2);
      }

      .save-btn-gradient {
        background: linear-gradient(
          45deg,
          var(--accent-indigo),
          var(--accent-purple)
        );
        color: white;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        position: relative;
        overflow: hidden;
      }

      .save-btn-gradient:hover {
        background: linear-gradient(
          45deg,
          var(--accent-purple),
          var(--accent-indigo)
        );
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.6);
        transform: translateY(-3px) translateZ(0);
      }

      .save-btn-gradient:active {
        transform: translateY(-1px) translateZ(0);
      }

      .card-income {
        background: linear-gradient(135deg, var(--accent-green), #27ae60);
        transform: translateZ(0);
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
      }

      .card-income:hover {
        transform: translateY(-5px) translateZ(0);
        box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
      }

      .card-expense {
        background: linear-gradient(135deg, var(--button-red), #c0392b);
        transform: translateZ(0);
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
      }

      .card-expense:hover {
        transform: translateY(-5px) translateZ(0);
        box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
      }

      .card-balance {
        background: linear-gradient(
          135deg,
          var(--accent-indigo),
          var(--accent-purple)
        );
        transform: translateZ(0);
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
      }

      .card-balance:hover {
        transform: translateY(-5px) translateZ(0);
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
      }

      .balance-positive {
        color: var(--accent-green) !important;
        font-weight: 800;
      }
      .balance-negative {
        color: var(--button-red) !important;
        font-weight: 800;
      }

      #status-message {
        margin-top: 1rem;
        padding: 0.75rem;
        border-radius: 12px;
        font-weight: 600;
        text-align: center;
        transition: all 0.5s ease;
        box-sizing: border-box;
        transform: translateZ(0);
      }
      .status-positive {
        background-color: rgba(46, 204, 113, 0.2);
        border: 2px solid var(--accent-green);
        color: var(--accent-green);
        box-shadow: 0 4px 12px rgba(46, 204, 113, 0.2);
      }
      .status-negative {
        background-color: rgba(231, 76, 60, 0.2);
        border: 2px solid var(--button-red);
        color: var(--button-red);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.2);
      }

      .transaction-item {
        border-bottom: 1px solid rgba(236, 240, 241, 0.1);
        transition: all 0.3s ease;
        box-sizing: border-box;
        animation: slideIn 0.3s ease-out;
        transform: translateZ(0);
        border-radius: 8px;
        margin-bottom: 4px;
      }
      .transaction-item:hover {
        background-color: #3f556d;
        transform: translateX(5px) translateZ(0);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      .income-amount {
        color: var(--accent-green);
      }
      .expense-amount {
        color: var(--button-red);
      }

      #transaction-list {
        max-height: 400px;
        overflow-y: auto;
        box-sizing: border-box;
      }
      #transaction-list::-webkit-scrollbar {
        width: 8px;
      }
      #transaction-list::-webkit-scrollbar-thumb {
        background: linear-gradient(
          135deg,
          var(--accent-indigo),
          var(--accent-purple)
        );
        border-radius: 10px;
      }

      .rp-input-group {
        display: flex;
        align-items: stretch;
        width: 100%;
        border-radius: 12px;
        overflow: hidden;
        box-sizing: border-box;
        transform: translateZ(0);
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(155, 89, 182, 0.1);
      }

      .rp-input-group:focus-within {
        box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        transform: translateY(-2px) translateZ(0);
      }

      .rp-input-prefix {
        background-color: var(--primary-dark);
        color: var(--text-light);
        padding: 0.75rem 0.5rem 0.75rem 1rem;
        font-weight: 600;
        border: 2px solid var(--accent-purple);
        border-right: none;
        display: flex;
        align-items: center;
        box-sizing: border-box;
      }

      .rp-input-field {
        flex-grow: 1;
        background-color: var(--primary-dark);
        border: 2px solid var(--accent-purple);
        border-left: none;
        color: var(--text-light);
        padding: 0.75rem 1rem 0.75rem 0.5rem;
        text-align: right;
        box-sizing: border-box;
        transition: all 0.3s ease;
      }

      .rp-input-field:focus {
        border-color: var(--accent-green);
        box-shadow: 0 0 0 2px rgba(46, 204, 113, 0.5);
        outline: none;
      }

      .category-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.7rem;
        font-weight: 600;
        margin-left: 8px;
        transition: all 0.3s ease;
        transform: translateZ(0);
      }

      .category-badge:hover {
        transform: scale(1.05) translateZ(0);
        box-shadow: 0 2px 8px rgba(155, 89, 182, 0.3);
      }

      .analytics-section {
        background: var(--primary-dark);
        border-radius: 15px;
        border: 2px solid var(--accent-purple);
        box-shadow: 0 8px 25px rgba(155, 89, 182, 0.3);
        padding: 20px;
        margin-top: 20px;
        transform: translateZ(0);
        transition: all 0.3s ease;
      }

      .analytics-section:hover {
        box-shadow: 0 12px 30px rgba(155, 89, 182, 0.4);
        transform: translateY(-2px) translateZ(0);
      }

      .chart-container {
        position: relative;
        height: 300px;
        background: rgba(31, 42, 56, 0.8);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 20px;
        transform: translateZ(0);
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .chart-container:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        transform: translateY(-2px) translateZ(0);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, var(--secondary-dark), #34495e);
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid var(--accent-indigo);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        transform: translateZ(0);
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .stat-card:hover {
        transform: translateY(-5px) translateZ(0);
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        border-left: 4px solid var(--accent-yellow);
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: 800;
        margin: 10px 0;
        background: linear-gradient(
          45deg,
          var(--accent-yellow),
          var(--accent-purple)
        );
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }

      .stat-trend-up {
        color: var(--accent-green);
      }
      .stat-trend-down {
        color: var(--button-red);
      }

      .health-score {
        font-size: 2.5rem;
        font-weight: 900;
        background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        color: transparent;
        animation: gradientShift 3s infinite;
        background-size: 300% 300%;
      }

      @keyframes gradientShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .transaction-details {
        max-height: 200px;
        overflow-y: auto;
        margin-top: 10px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        transform: translateZ(0);
        transition: all 0.3s ease;
      }

      .transaction-detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .transaction-detail-item:hover {
        background: rgba(255, 255, 255, 0.05);
        transform: translateX(5px) translateZ(0);
      }

      .transaction-detail-item:last-child {
        border-bottom: none;
      }

      #message-box,
      #fun-message-box {
        z-index: 100;
        transform: translateZ(0);
        transition: all 0.3s ease;
      }

      .add-category-btn {
        background: transparent;
        border: 2px dashed var(--accent-purple);
        color: var(--accent-purple);
        padding: 12px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        transform: translateZ(0);
      }

      .add-category-btn:hover {
        background: var(--accent-purple);
        color: white;
        transform: scale(1.05) translateZ(0);
        box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
      }

      .auto-category-suggestions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 12px;
      }

      .auto-category-badge {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(155, 89, 182, 0.2);
        color: var(--accent-purple);
        border: 2px solid var(--accent-purple);
        transform: translateZ(0);
      }

      .auto-category-badge:hover {
        transform: scale(1.1) translateZ(0);
        background: rgba(155, 89, 182, 0.3);
        box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
      }

      .auto-category-badge.selected {
        background: var(--accent-purple);
        color: white;
        transform: scale(1.15) translateZ(0);
        box-shadow: 0 6px 15px rgba(155, 89, 182, 0.4);
      }

      .savings-header {
        background: linear-gradient(
          135deg,
          var(--accent-indigo),
          var(--accent-purple)
        );
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        text-align: center;
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        transform: translateZ(0);
        transition: all 0.3s ease;
      }

      .savings-header:hover {
        transform: translateY(-3px) translateZ(0);
        box-shadow: 0 12px 30px rgba(99, 102, 241, 0.4);
      }

      .savings-card {
        background: linear-gradient(135deg, var(--primary-dark), #2c3e50);
        border: 2px solid var(--accent-indigo);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Perbaikan: nilai box-shadow yang valid */
        transform: translateZ(0);
        position: relative;
        overflow: hidden;
      }

      .savings-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s;
      }

      .savings-card:hover::before {
        left: 100%;
      }

      .savings-card:hover {
        transform: translateY(-8px) translateZ(0);
        box-shadow: 0 12px 30px rgba(99, 102, 241, 0.4);
        border-color: var(--accent-yellow);
      }

      .savings-progress {
        height: 12px;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.1);
        overflow: hidden;
        margin: 15px 0;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        transform: translateZ(0);
      }

      .savings-progress-bar {
        height: 100%;
        border-radius: 6px;
        background: linear-gradient(
          45deg,
          var(--accent-green),
          var(--accent-indigo)
        );
        transition: all 0.5s ease;
        box-shadow: 0 2px 8px rgba(46, 204, 113, 0.4);
        position: relative;
        overflow: hidden;
      }

      .savings-progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .amount-buttons {
        display: flex;
        gap: 10px;
        margin: 20px 0;
      }

      .amount-btn {
        flex: 1;
        padding: 15px;
        border: 2px solid var(--accent-purple);
        background: transparent;
        color: var(--accent-purple);
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.1em;
        transform: translateZ(0);
        position: relative;
        overflow: hidden;
      }

      .amount-btn:hover {
        background: var(--accent-purple);
        color: white;
        transform: translateY(-3px) translateZ(0);
        box-shadow: 0 6px 15px rgba(155, 89, 182, 0.3);
      }

      .amount-btn.increase-btn:hover {
        background: var(--accent-green);
        border-color: var(--accent-green);
        box-shadow: 0 6px 15px rgba(46, 204, 113, 0.3);
      }

      .amount-btn.decrease-btn:hover {
        background: var(--button-red);
        border-color: var(--button-red);
        box-shadow: 0 6px 15px rgba(231, 76, 60, 0.3);
      }

      .amount-btn.active {
        color: white;
        transform: translateY(-3px) translateZ(0);
        box-shadow: 0 6px 15px rgba(155, 89, 182, 0.3);
      }

      .amount-btn.increase-btn.active {
        background: var(--accent-green);
        border-color: var(--accent-green);
        box-shadow: 0 6px 15px rgba(46, 204, 113, 0.4);
      }

      .amount-btn.decrease-btn.active {
        background: var(--button-red);
        border-color: var(--button-red);
        box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
      }

      .savings-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 2px solid rgba(255, 255, 255, 0.1);
      }

      .stat-item {
        text-align: center;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        transition: all 0.3s ease;
        transform: translateZ(0);
        cursor: pointer;
      }

      .stat-item:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: scale(1.05) translateZ(0);
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
      }

      .stat-value-sm {
        font-size: 1.3em;
        font-weight: 700;
        color: var(--accent-yellow);
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.8em;
        color: #bdc3c7;
        font-weight: 600;
      }

      .savings-plan-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin: 15px 0;
      }

      .savings-plan-btn {
        padding: 12px 8px;
        border: 2px solid var(--accent-purple);
        background: transparent;
        color: var(--accent-purple);
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 0.9em;
        transform: translateZ(0);
      }

      .savings-plan-btn.active {
        background: var(--accent-purple);
        color: white;
        transform: scale(1.05) translateZ(0);
        box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
      }

      .savings-plan-btn:hover {
        background: var(--accent-purple);
        color: white;
        transform: translateY(-2px) translateZ(0);
      }

      .delete-savings-btn {
        background: linear-gradient(45deg, var(--button-red), #c0392b);
        color: white;
        border: none;
        padding: 12px 16px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        transform: translateZ(0);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        width: 100%;
        font-size: 1em;
      }

      .delete-savings-btn:hover {
        transform: translateY(-3px) translateZ(0);
        box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        background: linear-gradient(45deg, #c0392b, var(--button-red));
      }

      .add-money-btn {
        background: linear-gradient(
          45deg,
          var(--accent-indigo),
          var(--accent-purple)
        );
        color: white;
        border: none;
        padding: 12px 16px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        transform: translateZ(0);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        width: 100%;
        font-size: 1em;
      }

      .add-money-btn:hover {
        transform: translateY(-3px) translateZ(0);
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.6);
        background: linear-gradient(
          45deg,
          var(--accent-purple),
          var(--accent-indigo)
        );
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #bdc3c7;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        border: 2px dashed var(--accent-purple);
        transform: translateZ(0);
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .empty-state:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-5px) translateZ(0);
        box-shadow: 0 8px 20px rgba(155, 89, 182, 0.2);
      }

      .empty-state i {
        font-size: 4em;
        margin-bottom: 20px;
        opacity: 0.5;
        color: var(--accent-purple);
        transition: all 0.3s ease;
      }

      .empty-state:hover i {
        transform: scale(1.1);
        opacity: 0.8;
      }

      .empty-state p {
        font-size: 1.2em;
        margin-bottom: 10px;
        transition: all 0.3s ease;
      }

      .empty-state:hover p {
        color: var(--text-light);
      }

      .empty-state .text-sm {
        font-size: 1em;
      }

      .hidden {
        display: none !important;
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 20px;
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background: var(--secondary-dark);
        border-radius: 20px;
        padding: 30px;
        width: 100%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        border: 2px solid var(--accent-purple);
        animation: modalSlideIn 0.3s ease-out;
        transform: translateZ(0);
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-50px) scale(0.9);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      * {
        cursor: default;
      }

      button,
      .btn-style,
      .type-btn,
      .amount-btn,
      .savings-plan-btn,
      .auto-category-badge,
      .stat-card,
      .savings-card,
      .transaction-item,
      .empty-state {
        cursor: pointer !important;
      }

      input,
      select,
      textarea {
        cursor: text !important;
      }

      @media (max-width: 768px) {
        .tab-button {
          padding: 12px 8px 10px 8px;
          font-size: 1em;
        }

        .tab-content {
          padding: 15px;
        }

        .chart-container {
          height: 250px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .stat-value {
          font-size: 1.5rem;
        }

        .savings-stats {
          grid-template-columns: 1fr;
        }

        .amount-buttons {
          flex-direction: column;
        }

        .modal-content {
          padding: 20px;
          margin: 10px;
        }

        .savings-card {
          padding: 15px;
        }

        .transaction-form {
          grid-template-columns: 1fr !important;
        }

        .type-btn {
          padding: 10px;
          font-size: 0.9em;
        }

        .add-money-btn,
        .delete-savings-btn {
          padding: 10px 12px;
          font-size: 0.9em;
        }
      }

      @media (max-width: 480px) {
        .main-app {
          border-radius: 10px;
        }

        .tab-nav {
          border-radius: 10px 10px 0 0;
        }

        .savings-header {
          padding: 15px;
        }

        .savings-header h2 {
          font-size: 1.5em;
        }

        .card-income,
        .card-expense,
        .card-balance {
          padding: 15px 10px;
        }

        .stat-card {
          padding: 15px;
        }

        .add-money-btn,
        .delete-savings-btn {
          padding: 8px 10px;
          font-size: 0.8em;
        }
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .loading-pulse {
        animation: pulse 1.5s ease-in-out infinite;
      }

      * {
        transition: color 0.3s ease, background-color 0.3s ease,
          border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
      }
    </style>
  </head>
  <body class="p-0">
    <div class="main-app">
      <header class="p-6 bg-gray-800 rounded-t-lg shadow-lg">
        <div class="flex items-center justify-between">
          <h1
            class="text-2xl font-extrabold text-white flex items-center gap-3"
          >
            <i class="fas fa-chart-line text-yellow-400"></i> Money Manager
          </h1>
          <span id="loading-indicator" class="hidden text-sm text-yellow-400">
            <i class="fas fa-spinner fa-spin"></i> Memuat...
          </span>
        </div>
        <div class="text-xs mt-2 text-gray-400">
          Data disimpan secara <strong>Lokal</strong> di Perangkat Anda.
        </div>
      </header>

      <div class="tab-nav">
        <button class="tab-button active" onclick="showTab('budget')">
          üí∞ Budget Planner
        </button>
        <button class="tab-button" onclick="showTab('celengan')">
          üê∑ Celengan
        </button>
      </div>

      <div id="budget-content" class="tab-content active">
        <section id="dashboard" class="mb-6">
          <h2
            class="text-xl font-bold mb-4 text-center"
            style="color: var(--accent-yellow)"
          >
            Ringkasan Keuangan
          </h2>
          <div class="grid grid-cols-3 gap-4 text-center">
            <div class="p-3 rounded-xl shadow-md card-income">
              <p class="text-sm font-semibold">Pemasukan</p>
              <p
                id="total-income"
                class="text-xl font-extrabold mt-1 text-white"
              >
                Rp 0
              </p>
            </div>
            <div class="p-3 rounded-xl shadow-md card-expense">
              <p class="text-sm font-semibold">Pengeluaran</p>
              <p
                id="total-expense"
                class="text-xl font-extrabold mt-1 text-white"
              >
                Rp 0
              </p>
            </div>
            <div class="p-3 rounded-xl shadow-md card-balance">
              <p class="text-sm font-medium">Saldo Bersih</p>
              <p
                id="net-balance"
                class="text-xl font-extrabold mt-1 text-white"
              >
                Rp 0
              </p>
            </div>
          </div>
          <div id="status-message" class="hidden"></div>
        </section>

        <section id="transaction-form-section" class="mb-6">
          <h2
            class="text-xl font-bold mb-4"
            style="color: var(--accent-purple)"
          >
            Tambah Transaksi Baru
          </h2>
          <form
            id="transaction-form"
            class="grid grid-cols-1 md:grid-cols-6 gap-3"
          >
            <div class="col-span-full md:col-span-2 flex">
              <button
                type="button"
                class="type-btn income active"
                data-type="income"
              >
                <i class="fas fa-arrow-down mr-2"></i>Pemasukan
              </button>
              <button
                type="button"
                class="type-btn expense"
                data-type="expense"
              >
                <i class="fas fa-arrow-up mr-2"></i>Pengeluaran
              </button>
            </div>
            <input
              type="text"
              id="description"
              placeholder="Deskripsi transaksi...(contoh: uang saku)"
              required
              class="col-span-full md:col-span-2 p-3 rounded-lg input-style"
            />
            <input
              type="date"
              id="transaction-date"
              required
              class="col-span-full md:col-span-2 p-3 rounded-lg input-style"
            />
            <div class="col-span-full">
              <label
                class="block text-sm font-medium mb-2"
                style="color: var(--accent-purple)"
              >
                <i class="fas fa-tags mr-2"></i>Kategori (Otomatis)
              </label>
              <div
                id="auto-category-suggestions"
                class="auto-category-suggestions"
              ></div>
              <input
                type="text"
                id="category"
                placeholder="Kategori akan terisi otomatis berdasarkan deskripsi..."
                readonly
                class="w-full p-3 rounded-lg input-style bg-gray-700 cursor-not-allowed"
              />
              <div class="mt-2">
                <input
                  type="text"
                  id="custom-category"
                  placeholder="Atau buat kategori baru..."
                  class="w-full p-3 rounded-lg input-style"
                />
              </div>
            </div>
            <div class="col-span-full md:col-span-4 rp-input-group">
              <span class="rp-input-prefix rounded-l-lg">Rp</span>
              <input
                type="text"
                id="amount"
                placeholder="Jumlah"
                required
                class="rp-input-field rounded-r-lg"
              />
            </div>
            <button
              type="submit"
              class="col-span-full md:col-span-2 p-3 rounded-lg btn-style save-btn-gradient"
            >
              <i class="fas fa-save mr-2"></i> Simpan
            </button>
          </form>
        </section>

        <section id="transaction-list-section" class="mb-6">
          <h2
            class="text-xl font-bold mb-4"
            style="color: var(--accent-purple)"
          >
            Daftar Transaksi
          </h2>
          <div id="transaction-list" class="bg-primary-dark rounded-lg p-2">
            <p id="empty-state" class="text-center text-gray-500 py-6">
              Belum ada transaksi. Tambahkan yang pertama!
            </p>
          </div>
        </section>

        <section class="analytics-section">
          <h2
            class="text-xl font-bold mb-4 text-center"
            style="color: var(--accent-yellow)"
          >
            <i class="fas fa-chart-bar mr-2"></i>Analytics & Statistics
          </h2>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-primary-dark rounded-xl p-4">
              <h3
                class="text-lg font-bold mb-3 text-center"
                style="color: var(--accent-purple)"
              >
                <i class="fas fa-chart-pie mr-2"></i>Spending by Category
              </h3>
              <div class="chart-container">
                <canvas id="categoryChart"></canvas>
              </div>
              <div
                id="category-details"
                class="transaction-details hidden"
              ></div>
            </div>
            <div class="bg-primary-dark rounded-xl p-4">
              <h3
                class="text-lg font-bold mb-3 text-center"
                style="color: var(--accent-indigo)"
              >
                <i class="fas fa-chart-bar mr-2"></i>Monthly Comparison
              </h3>
              <div class="chart-container">
                <canvas id="monthlyChart"></canvas>
              </div>
            </div>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="flex items-center justify-between">
                <h4
                  class="font-bold text-sm"
                  style="color: var(--accent-green)"
                >
                  <i class="fas fa-piggy-bank mr-2"></i>Saving Rate
                </h4>
                <span id="saving-trend" class="text-sm"></span>
              </div>
              <div id="saving-rate" class="stat-value">0%</div>
              <p class="text-xs text-gray-400">Dari total pemasukan</p>
            </div>
            <div class="stat-card">
              <div class="flex items-center justify-between">
                <h4
                  class="font-bold text-sm"
                  style="color: var(--accent-indigo)"
                >
                  <i class="fas fa-calendar-alt mr-2"></i>Avg Monthly Spend
                </h4>
                <span id="spend-trend" class="text-sm"></span>
              </div>
              <div id="avg-monthly-spend" class="stat-value">Rp 0</div>
              <p class="text-xs text-gray-400">Rata-rata per bulan</p>
            </div>
            <div class="stat-card">
              <h4 class="font-bold text-sm" style="color: var(--button-red)">
                <i class="fas fa-fire mr-2"></i>Most Spent Category
              </h4>
              <div id="most-spent-category" class="stat-value">-</div>
              <p id="most-spent-amount" class="text-xs text-gray-400">Rp 0</p>
            </div>
            <div class="stat-card">
              <h4 class="font-bold text-sm" style="color: var(--accent-yellow)">
                <i class="fas fa-heartbeat mr-2"></i>Financial Health
              </h4>
              <div id="financial-score" class="health-score">0</div>
              <p class="text-xs text-gray-400">Skor kesehatan keuangan</p>
            </div>
          </div>
          <div class="stats-grid mt-6">
            <div class="stat-card">
              <h4 class="font-bold text-sm" style="color: var(--accent-green)">
                <i class="fas fa-arrow-up mr-2"></i>Total Pemasukan
              </h4>
              <div id="total-income-stats" class="stat-value">Rp 0</div>
              <p class="text-xs text-gray-400">Seluruh waktu</p>
            </div>
            <div class="stat-card">
              <h4 class="font-bold text-sm" style="color: var(--button-red)">
                <i class="fas fa-arrow-down mr-2"></i>Total Pengeluaran
              </h4>
              <div id="total-expense-stats" class="stat-value">Rp 0</div>
              <p class="text-xs text-gray-400">Seluruh waktu</p>
            </div>
            <div class="stat-card">
              <h4 class="font-bold text-sm" style="color: var(--accent-purple)">
                <i class="fas fa-exchange-alt mr-2"></i>Transaksi Tertinggi
              </h4>
              <div id="highest-transaction" class="stat-value">Rp 0</div>
              <p
                id="highest-transaction-desc"
                class="text-xs text-gray-400 truncate"
              >
                -
              </p>
            </div>
            <div class="stat-card">
              <h4 class="font-bold text-sm" style="color: var(--accent-indigo)">
                <i class="fas fa-history mr-2"></i>Total Transaksi
              </h4>
              <div id="total-transactions" class="stat-value">0</div>
              <p class="text-xs text-gray-400">Seluruh waktu</p>
            </div>
          </div>
        </section>
      </div>

      <div id="celengan-content" class="tab-content">
        <div class="savings-header">
          <h2 class="text-2xl font-bold mb-2 text-white">
            <i class="fas fa-piggy-bank mr-3"></i>Celengan Digital
          </h2>
          <p class="text-gray-200">
            Kelola tabungan dan capai tujuan finansial Anda
          </p>
        </div>
        <div class="text-center mb-6">
          <button
            id="add-savings-btn"
            class="p-4 rounded-lg btn-style save-btn-gradient w-full max-w-md mx-auto"
          >
            <i class="fas fa-plus-circle mr-2"></i> Buat Celengan Baru
          </button>
        </div>
        <div id="savings-list" class="space-y-4">
          <div class="empty-state">
            <i class="fas fa-coins"></i>
            <p>Belum Ada Celengan</p>
            <p class="text-sm mt-2">
              Mulai menabung dengan membuat celengan pertama Anda!
            </p>
          </div>
        </div>
        <div id="savings-modal" class="modal-overlay hidden">
          <div class="modal-content">
            <h3
              class="text-2xl font-bold mb-6 text-center"
              style="color: var(--accent-yellow)"
              id="modal-title"
            >
              <i class="fas fa-plus-circle mr-2"></i>Buat Celengan Baru
            </h3>
            <form id="savings-form" class="space-y-6">
              <div>
                <label
                  class="block text-sm font-medium mb-3"
                  style="color: var(--accent-purple)"
                >
                  <i class="fas fa-tag mr-2"></i>Nama Celengan
                </label>
                <input
                  type="text"
                  id="savings-name"
                  placeholder="Contoh: Ipad Pro, Liburan, dll"
                  class="w-full p-4 rounded-lg input-style text-lg"
                />
              </div>
              <div>
                <label
                  class="block text-sm font-medium mb-3"
                  style="color: var(--accent-purple)"
                >
                  <i class="fas fa-bullseye mr-2"></i>Target Jumlah
                </label>
                <div
                  class="flex items-stretch w-full rounded-lg overflow-hidden"
                >
                  <span
                    class="bg-primary-dark text-white px-4 flex items-center border-2 border-accent-purple border-r-0"
                    >Rp</span
                  >
                  <input
                    type="text"
                    id="savings-target"
                    placeholder="25.000.000"
                    class="flex-1 p-4 input-style border-l-0 text-right text-lg"
                  />
                </div>
              </div>
              <div>
                <label
                  class="block text-sm font-medium mb-3"
                  style="color: var(--accent-purple)"
                >
                  <i class="fas fa-calendar mr-2"></i>Rencana Menabung
                </label>
                <div class="savings-plan-buttons">
                  <button
                    type="button"
                    class="savings-plan-btn active"
                    data-plan="daily"
                  >
                    <i class="fas fa-calendar-day mr-1"></i>Harian
                  </button>
                  <button
                    type="button"
                    class="savings-plan-btn"
                    data-plan="weekly"
                  >
                    <i class="fas fa-calendar-week mr-1"></i>Mingguan
                  </button>
                  <button
                    type="button"
                    class="savings-plan-btn"
                    data-plan="monthly"
                  >
                    <i class="fas fa-calendar-alt mr-1"></i>Bulanan
                  </button>
                </div>
              </div>
              <div>
                <label
                  class="block text-sm font-medium mb-3"
                  style="color: var(--accent-purple)"
                >
                  <i class="fas fa-money-bill-wave mr-2"></i>Nominal Menabung
                </label>
                <div
                  class="flex items-stretch w-full rounded-lg overflow-hidden"
                >
                  <span
                    class="bg-primary-dark text-white px-4 flex items-center border-2 border-accent-purple border-r-0"
                    >Rp</span
                  >
                  <input
                    type="text"
                    id="savings-amount"
                    placeholder="125.000"
                    class="flex-1 p-4 input-style border-l-0 text-right text-lg"
                  />
                </div>
              </div>
              <div class="flex gap-4 pt-4">
                <button
                  type="button"
                  id="cancel-savings"
                  class="flex-1 p-4 rounded-lg bg-gray-600 text-white font-bold hover:bg-gray-700 transition-colors"
                >
                  <i class="fas fa-times mr-2"></i>Batal
                </button>
                <button
                  type="submit"
                  class="flex-1 p-4 rounded-lg save-btn-gradient font-bold"
                >
                  <i class="fas fa-check mr-2"></i>Simpan
                </button>
              </div>
            </form>
          </div>
        </div>
        <div id="add-money-modal" class="modal-overlay hidden">
          <div class="modal-content">
            <h3
              class="text-2xl font-bold mb-6 text-center"
              style="color: var(--accent-yellow)"
              id="add-money-title"
            >
              <i class="fas fa-money-bill-wave mr-2"></i>Tambah Uang
            </h3>
            <form id="add-money-form" class="space-y-6">
              <div class="amount-buttons">
                <button
                  type="button"
                  class="amount-btn increase-btn active"
                  data-action="increase"
                >
                  <i class="fas fa-plus-circle mr-2"></i>Tambah
                </button>
                <button
                  type="button"
                  class="amount-btn decrease-btn"
                  data-action="decrease"
                >
                  <i class="fas fa-minus-circle mr-2"></i>Kurangi
                </button>
              </div>
              <div>
                <label
                  class="block text-sm font-medium mb-3 text-center"
                  style="color: var(--accent-purple)"
                >
                  Jumlah
                </label>
                <div
                  class="flex items-stretch w-full rounded-lg overflow-hidden"
                >
                  <span
                    class="bg-primary-dark text-white px-4 flex items-center border-2 border-accent-purple border-r-0"
                    >Rp</span
                  >
                  <input
                    type="text"
                    id="money-amount"
                    placeholder="50.000"
                    class="flex-1 p-4 input-style border-l-0 text-center text-2xl font-bold"
                  />
                </div>
              </div>
              <div>
                <label
                  class="block text-sm font-medium mb-3"
                  style="color: var(--accent-purple)"
                >
                  <i class="fas fa-sticky-note mr-2"></i>Keterangan (Opsional)
                </label>
                <input
                  type="text"
                  id="money-description"
                  placeholder="Contoh: Tabungan minggu ini"
                  class="w-full p-4 rounded-lg input-style"
                />
              </div>
              <div class="flex gap-4 pt-4">
                <button
                  type="button"
                  id="cancel-add-money"
                  class="flex-1 p-4 rounded-lg bg-gray-600 text-white font-bold hover:bg-gray-700 transition-colors"
                >
                  <i class="fas fa-times mr-2"></i>Batal
                </button>
                <button
                  type="submit"
                  class="flex-1 p-4 rounded-lg save-btn-gradient font-bold"
                >
                  <i class="fas fa-check mr-2"></i>Simpan
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div
        id="message-box"
        class="fixed bottom-5 right-5 p-4 rounded-lg shadow-xl text-white hidden z-50 transition-opacity duration-300"
      ></div>
      <div
        id="fun-message-box"
        class="fixed bottom-5 right-5 p-4 rounded-lg shadow-xl text-white hidden z-60 transition-opacity duration-300"
      ></div>
    </div>

    <script>
      const STORAGE_KEY = "budgetPlannerTransactions";
      const CATEGORIES_KEY = "budgetPlannerCategories";
      const SAVINGS_KEY = "budgetPlannerSavings";

      const loadingIndicator = document.getElementById("loading-indicator");
      const transactionList = document.getElementById("transaction-list");
      const emptyState = document.getElementById("empty-state");
      const dashboard = {
        income: document.getElementById("total-income"),
        expense: document.getElementById("total-expense"),
        balance: document.getElementById("net-balance"),
        statusMessage: document.getElementById("status-message"),
      };
      const transactionForm = document.getElementById("transaction-form");
      const amountInput = document.getElementById("amount");
      const descriptionInput = document.getElementById("description");
      const dateInput = document.getElementById("transaction-date");
      const categoryInput = document.getElementById("category");
      const customCategoryInput = document.getElementById("custom-category");
      const messageBox = document.getElementById("message-box");
      const funMessageBox = document.getElementById("fun-message-box");
      const categoryDetails = document.getElementById("category-details");
      const autoCategorySuggestions = document.getElementById(
        "auto-category-suggestions"
      );
      const savingsList = document.getElementById("savings-list");
      const savingsModal = document.getElementById("savings-modal");
      const addMoneyModal = document.getElementById("add-money-modal");
      const savingsForm = document.getElementById("savings-form");
      const addMoneyForm = document.getElementById("add-money-form");
      const addSavingsBtn = document.getElementById("add-savings-btn");
      const cancelSavings = document.getElementById("cancel-savings");
      const cancelAddMoney = document.getElementById("cancel-add-money");
      const typeButtons = document.querySelectorAll(".type-btn");
      let categoryChart, monthlyChart;
      let transactions = [];
      let categories = [];
      let savings = [];
      let currentTransactionType = "income";
      let currentSavingsPlan = "daily";
      let editingSavingsId = null;
      let currentSavingsId = null;
      let currentMoneyAction = "increase";

      const autoCategoryMap = {
        gaji: "Gaji",
        upah: "Gaji",
        salary: "Gaji",
        bonus: "Bonus",
        tunjangan: "Tunjangan",
        "uang saku": "Uang Saku",
        pendapatan: "Pendapatan",
        hasil: "Pendapatan",
        investasi: "Investasi",
        dividen: "Dividen",
        bunga: "Bunga",
        hibah: "Hibah",
        hadiah: "Hadiah",
        makan: "Makanan & Minuman",
        makanan: "Makanan & Minuman",
        minuman: "Makanan & Minuman",
        restoran: "Makanan & Minuman",
        warung: "Makanan & Minuman",
        kafe: "Makanan & Minuman",
        transport: "Transportasi",
        transportasi: "Transportasi",
        bensin: "Transportasi",
        bus: "Transportasi",
        kereta: "Transportasi",
        ojek: "Transportasi",
        taksi: "Transportasi",
        parkir: "Transportasi",
        belanja: "Belanja",
        pakaian: "Belanja",
        baju: "Belanja",
        celana: "Belanja",
        sepatu: "Belanja",
        aksesoris: "Belanja",
        hiburan: "Hiburan",
        film: "Hiburan",
        nonton: "Hiburan",
        konser: "Hiburan",
        game: "Hiburan",
        hobi: "Hiburan",
        tagihan: "Tagihan",
        listrik: "Tagihan",
        air: "Tagihan",
        internet: "Tagihan",
        pulsa: "Tagihan",
        "paket data": "Tagihan",
        kesehatan: "Kesehatan",
        dokter: "Kesehatan",
        obat: "Kesehatan",
        "rumah sakit": "Kesehatan",
        apotek: "Kesehatan",
        pendidikan: "Pendidikan",
        sekolah: "Pendidikan",
        kuliah: "Pendidikan",
        buku: "Pendidikan",
        kursus: "Pendidikan",
        utilitas: "Utilitas",
        perbaikan: "Utilitas",
        maintenance: "Utilitas",
        lain: "Lain-lain",
        lainnya: "Lain-lain",
        other: "Lain-lain",
      };

      function setupAutoCategory() {
        descriptionInput.addEventListener("input", function () {
          const description = this.value.toLowerCase();
          const detectedCategories = detectCategories(description);
          updateCategorySuggestions(detectedCategories);
        });
        customCategoryInput.addEventListener("input", function () {
          if (this.value.trim()) {
            categoryInput.value = this.value.trim();
            document
              .querySelectorAll(".auto-category-badge")
              .forEach((badge) => {
                badge.classList.remove("selected");
              });
          }
        });
        autoCategorySuggestions.addEventListener("click", function (e) {
          if (e.target.classList.contains("auto-category-badge")) {
            customCategoryInput.value = "";
          }
        });
      }

      function detectCategories(description) {
        const detected = new Set();
        if (currentTransactionType === "income") {
          Object.entries(autoCategoryMap).forEach(([keyword, category]) => {
            if (
              description.includes(keyword) &&
              [
                "Gaji",
                "Bonus",
                "Tunjangan",
                "Uang Saku",
                "Pendapatan",
                "Investasi",
                "Dividen",
                "Bunga",
                "Hibah",
                "Hadiah",
              ].includes(category)
            ) {
              detected.add(category);
            }
          });
        }
        if (currentTransactionType === "expense") {
          Object.entries(autoCategoryMap).forEach(([keyword, category]) => {
            if (
              description.includes(keyword) &&
              ![
                "Gaji",
                "Bonus",
                "Tunjangan",
                "Uang Saku",
                "Pendapatan",
                "Investasi",
                "Dividen",
                "Bunga",
                "Hibah",
                "Hadiah",
              ].includes(category)
            ) {
              detected.add(category);
            }
          });
        }
        if (detected.size === 0) {
          detected.add(
            currentTransactionType === "income" ? "Pendapatan" : "Lain-lain"
          );
        }
        return Array.from(detected);
      }

      function updateCategorySuggestions(categoryList) {
        autoCategorySuggestions.innerHTML = "";
        categoryList.forEach((category) => {
          const badge = document.createElement("div");
          badge.className = "auto-category-badge";
          badge.textContent = category;
          badge.addEventListener("click", function () {
            categoryInput.value = category;
            customCategoryInput.value = "";
            document.querySelectorAll(".auto-category-badge").forEach((b) => {
              b.classList.remove("selected");
            });
            this.classList.add("selected");
          });
          autoCategorySuggestions.appendChild(badge);
        });
        if (
          categoryList.length > 0 &&
          !categoryInput.value &&
          !customCategoryInput.value
        ) {
          const firstBadge = autoCategorySuggestions.firstChild;
          if (firstBadge) {
            firstBadge.click();
          }
        }
      }

      function setupTypeButtons() {
        typeButtons.forEach((button) => {
          button.addEventListener("click", function () {
            typeButtons.forEach((btn) => btn.classList.remove("active"));
            this.classList.add("active");
            currentTransactionType = this.dataset.type;
            if (descriptionInput.value) {
              const detectedCategories = detectCategories(
                descriptionInput.value.toLowerCase()
              );
              updateCategorySuggestions(detectedCategories);
            }
          });
        });
      }

      function initializeCharts() {
        if (categoryChart) categoryChart.destroy();
        if (monthlyChart) monthlyChart.destroy();
        const analytics = getSpendingAnalytics();
        const monthlyData = getMonthlyData();
        const categoryCtx = document
          .getElementById("categoryChart")
          .getContext("2d");
        categoryChart = new Chart(categoryCtx, {
          type: "doughnut",
          data: {
            labels: analytics.labels,
            datasets: [
              {
                data: analytics.data,
                backgroundColor: [
                  "#9b59b6",
                  "#3498db",
                  "#2ecc71",
                  "#f1c40f",
                  "#e74c3c",
                  "#1abc9c",
                ],
                borderWidth: 2,
                borderColor: "#1f2a38",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  color: "#ecf0f1",
                  font: { family: "Poppins", size: 11 },
                },
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const label = context.label || "";
                    const value = context.parsed;
                    const total = context.dataset.data.reduce(
                      (a, b) => a + b,
                      0
                    );
                    const percentage = Math.round((value / total) * 100);
                    return `${label}: Rp ${value.toLocaleString(
                      "id-ID"
                    )} (${percentage}%)`;
                  },
                },
              },
            },
            onClick: (evt, elements) => {
              if (elements.length > 0) {
                const index = elements[0].index;
                const category = analytics.labels[index];
                showCategoryDetails(category);
              }
            },
          },
        });
        const monthlyCtx = document
          .getElementById("monthlyChart")
          .getContext("2d");
        monthlyChart = new Chart(monthlyCtx, {
          type: "bar",
          data: {
            labels: monthlyData.labels,
            datasets: [
              {
                label: "Pemasukan",
                data: monthlyData.income,
                backgroundColor: "rgba(46, 204, 113, 0.8)",
                borderColor: "#2ecc71",
                borderWidth: 2,
              },
              {
                label: "Pengeluaran",
                data: monthlyData.expense,
                backgroundColor: "rgba(231, 76, 60, 0.8)",
                borderColor: "#e74c3c",
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: { color: "#ecf0f1", font: { family: "Poppins" } },
                grid: { color: "rgba(236, 240, 241, 0.1)" },
              },
              x: {
                ticks: { color: "#ecf0f1", font: { family: "Poppins" } },
                grid: { color: "rgba(236, 240, 241, 0.1)" },
              },
            },
            plugins: {
              legend: {
                labels: { color: "#ecf0f1", font: { family: "Poppins" } },
              },
            },
          },
        });
      }

      function showCategoryDetails(category) {
        const categoryTransactions = transactions.filter(
          (t) => t.category === category && t.type === "expense"
        );
        if (categoryTransactions.length === 0) {
          categoryDetails.innerHTML =
            '<p class="text-gray-400 text-center">Tidak ada transaksi</p>';
        } else {
          let html = `<h4 class="font-bold mb-3" style="color: var(--accent-purple);">${category}</h4>`;
          categoryTransactions.forEach((t) => {
            const date = new Date(t.timestamp).toLocaleDateString("id-ID");
            html += `
                        <div class="transaction-detail-item">
                            <div class="flex-1">
                                <p class="font-medium text-sm">${
                                  t.description
                                }</p>
                                <p class="text-xs text-gray-400">${date}</p>
                            </div>
                            <p class="font-bold" style="color: var(--button-red);">${formatNumber(
                              t.amount
                            )}</p>
                        </div>
                    `;
          });
          const total = categoryTransactions.reduce(
            (sum, t) => sum + t.amount,
            0
          );
          html += `
                    <div class="transaction-detail-item border-t border-gray-600 pt-2 mt-2">
                        <p class="font-bold">Total</p>
                        <p class="font-bold">${formatNumber(total)}</p>
                    </div>
                `;
          categoryDetails.innerHTML = html;
        }
        categoryDetails.classList.remove("hidden");
      }

      function getSpendingAnalytics() {
        const expenseTransactions = transactions.filter(
          (t) => t.type === "expense"
        );
        const categories = {};
        expenseTransactions.forEach((t) => {
          categories[t.category] = (categories[t.category] || 0) + t.amount;
        });
        const labels = Object.keys(categories);
        const data = Object.values(categories);
        return { labels, data, categories };
      }

      function getMonthlyData() {
        const months = [];
        const incomeData = [];
        const expenseData = [];
        for (let i = 5; i >= 0; i--) {
          const date = new Date();
          date.setMonth(date.getMonth() - i);
          const monthYear = date.toLocaleDateString("id-ID", {
            month: "short",
            year: "numeric",
          });
          months.push(monthYear);
          const monthStart = new Date(date.getFullYear(), date.getMonth(), 1);
          const monthEnd = new Date(date.getFullYear(), date.getMonth() + 1, 0);
          const monthlyTransactions = transactions.filter((t) => {
            const transDate = new Date(t.timestamp);
            return transDate >= monthStart && transDate <= monthEnd;
          });
          const monthlyIncome = monthlyTransactions
            .filter((t) => t.type === "income")
            .reduce((sum, t) => sum + t.amount, 0);
          const monthlyExpense = monthlyTransactions
            .filter((t) => t.type === "expense")
            .reduce((sum, t) => sum + t.amount, 0);
          incomeData.push(monthlyIncome);
          expenseData.push(monthlyExpense);
        }
        return { labels: months, income: incomeData, expense: expenseData };
      }

      function calculateAdvancedStatistics() {
        const totalIncome = transactions
          .filter((t) => t.type === "income")
          .reduce((sum, t) => sum + t.amount, 0);
        const totalExpense = transactions
          .filter((t) => t.type === "expense")
          .reduce((sum, t) => sum + t.amount, 0);
        const totalTransactions = transactions.length;
        const savingRate =
          totalIncome > 0
            ? Math.round(((totalIncome - totalExpense) / totalIncome) * 100)
            : 0;
        const monthlyData = getMonthlyData();
        const avgMonthlySpend =
          monthlyData.expense.reduce((sum, val) => sum + val, 0) / 6;
        const categoryAnalytics = getSpendingAnalytics();
        let mostSpentCategory = "-";
        let mostSpentAmount = 0;
        Object.entries(categoryAnalytics.categories).forEach(
          ([category, amount]) => {
            if (amount > mostSpentAmount) {
              mostSpentCategory = category;
              mostSpentAmount = amount;
            }
          }
        );
        let highestTransaction = 0;
        let highestTransactionDesc = "-";
        transactions.forEach((t) => {
          if (t.amount > highestTransaction) {
            highestTransaction = t.amount;
            highestTransactionDesc = t.description;
          }
        });
        let financialScore = 0;
        if (totalIncome > 0) {
          const expenseRatio = totalExpense / totalIncome;
          const savingRatio = (totalIncome - totalExpense) / totalIncome;
          financialScore += Math.min(savingRatio * 60, 60);
          if (savingRatio > 0.2) financialScore += 20;
          if (expenseRatio < 0.7) financialScore += 10;
          if (totalTransactions > 5) financialScore += 10;
          financialScore = Math.round(Math.min(financialScore, 100));
        }
        return {
          savingRate: Math.max(0, savingRate),
          savingTrend: savingRate > 20 ? 1 : -1,
          avgMonthlySpend: Math.round(avgMonthlySpend),
          spendTrend: avgMonthlySpend < totalExpense / 6 ? -1 : 1,
          mostSpentCategory: mostSpentCategory,
          mostSpentAmount: mostSpentAmount,
          financialScore: financialScore,
          totalIncome: totalIncome,
          totalExpense: totalExpense,
          highestTransaction: highestTransaction,
          highestTransactionDesc: highestTransactionDesc,
          totalTransactions: totalTransactions,
        };
      }

      function updateAdvancedStatistics() {
        const stats = calculateAdvancedStatistics();
        document.getElementById(
          "saving-rate"
        ).textContent = `${stats.savingRate}%`;
        document.getElementById("avg-monthly-spend").textContent = formatNumber(
          stats.avgMonthlySpend
        );
        document.getElementById("most-spent-category").textContent =
          stats.mostSpentCategory;
        document.getElementById("most-spent-amount").textContent = formatNumber(
          stats.mostSpentAmount
        );
        document.getElementById("financial-score").textContent =
          stats.financialScore;
        document.getElementById("total-income-stats").textContent =
          formatNumber(stats.totalIncome);
        document.getElementById("total-expense-stats").textContent =
          formatNumber(stats.totalExpense);
        document.getElementById("highest-transaction").textContent =
          formatNumber(stats.highestTransaction);
        document.getElementById("highest-transaction-desc").textContent =
          stats.highestTransactionDesc;
        document.getElementById("    total-transactions").textContent =
          stats.totalTransactions;
        savingTrend.innerHTML =
          stats.savingTrend > 0
            ? '<i class="fas fa-arrow-up stat-trend-up"></i>'
            : '<i class="fas fa-arrow-down stat-trend-down"></i>';
        spendTrend.innerHTML =
          stats.spendTrend > 0
            ? '<i class="fas fa-arrow-up stat-trend-up"></i>'
            : '<i class="fas fa-arrow-down stat-trend-down"></i>';
      }

      function formatNumber(num) {
        return `Rp ${num.toLocaleString("id-ID")}`;
      }

      function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(transactions));
        localStorage.setItem(CATEGORIES_KEY, JSON.stringify(categories));
        localStorage.setItem(SAVINGS_KEY, JSON.stringify(savings));
      }

      function loadData() {
        const storedTransactions = localStorage.getItem(STORAGE_KEY);
        const storedCategories = localStorage.getItem(CATEGORIES_KEY);
        const storedSavings = localStorage.getItem(SAVINGS_KEY);
        if (storedTransactions) transactions = JSON.parse(storedTransactions);
        if (storedCategories) categories = JSON.parse(storedCategories);
        if (storedSavings) savings = JSON.parse(storedSavings);
        updateUI();
        updateSavingsUI();
      }

      function updateUI() {
        const totalIncome = transactions
          .filter((t) => t.type === "income")
          .reduce((sum, t) => sum + t.amount, 0);
        const totalExpense = transactions
          .filter((t) => t.type === "expense")
          .reduce((sum, t) => sum + t.amount, 0);
        const netBalance = totalIncome - totalExpense;

        dashboard.income.textContent = formatNumber(totalIncome);
        dashboard.expense.textContent = formatNumber(totalExpense);
        dashboard.balance.textContent = formatNumber(netBalance);

        if (netBalance > 0) {
          dashboard.balance.classList.add("balance-positive");
          dashboard.balance.classList.remove("balance-negative");
          dashboard.statusMessage.classList.remove("hidden");
          dashboard.statusMessage.classList.add("status-positive");
          dashboard.statusMessage.classList.remove("status-negative");
          dashboard.statusMessage.textContent =
            "Keuangan Anda sehat! Pertahankan tabungan Anda!";
        } else if (netBalance < 0) {
          dashboard.balance.classList.add("balance-negative");
          dashboard.balance.classList.remove("balance-positive");
          dashboard.statusMessage.classList.remove("hidden");
          dashboard.statusMessage.classList.add("status-negative");
          dashboard.statusMessage.classList.remove("status-positive");
          dashboard.statusMessage.textContent =
            "Pengeluaran melebihi pemasukan. Perhatikan anggaran Anda!";
        } else {
          dashboard.statusMessage.classList.add("hidden");
        }

        transactionList.innerHTML = "";
        if (transactions.length === 0) {
          emptyState.classList.remove("hidden");
        } else {
          emptyState.classList.add("hidden");
          transactions.sort(
            (a, b) => new Date(b.timestamp) - new Date(a.timestamp)
          );
          transactions.forEach((transaction) => {
            const li = document.createElement("div");
            li.className =
              "transaction-item p-3 flex justify-between items-center";
            const date = new Date(transaction.timestamp).toLocaleDateString(
              "id-ID"
            );
            li.innerHTML = `
                <div class="flex-1">
                    <p class="font-medium">${transaction.description}</p>
                    <p class="text-xs text-gray-400">${date} | <span class="category-badge" style="background: rgba(155, 89, 182, 0.2); color: var(--accent-purple);">${
              transaction.category
            }</span></p>
                </div>
                <p class="${
                  transaction.type === "income"
                    ? "income-amount"
                    : "expense-amount"
                } font-bold">
                    ${transaction.type === "income" ? "+" : "-"}${formatNumber(
              transaction.amount
            )}
                </p>
                <button class="ml-3 text-red-400 hover:text-red-600 transition-colors" onclick="deleteTransaction('${
                  transaction.id
                }')">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            transactionList.appendChild(li);
          });
        }
        initializeCharts();
        updateAdvancedStatistics();
      }

      function deleteTransaction(id) {
        transactions = transactions.filter((t) => t.id !== id);
        saveData();
        updateUI();
        showMessage("Transaksi dihapus!", "bg-red-600");
      }

      function showMessage(message, bgClass) {
        messageBox.textContent = message;
        messageBox.className = `fixed bottom-5 right-5 p-4 rounded-lg shadow-xl text-white ${bgClass} z-50`;
        messageBox.classList.remove("hidden");
        setTimeout(() => {
          messageBox.classList.add("hidden");
        }, 3000);
      }

      function showFunMessage(message, bgClass) {
        funMessageBox.textContent = message;
        funMessageBox.className = `fixed bottom-5 right-5 p-4 rounded-lg shadow-xl text-white ${bgClass} z-60`;
        funMessageBox.classList.remove("hidden");
        setTimeout(() => {
          funMessageBox.classList.add("hidden");
        }, 3000);
      }

      function generateId() {
        return "_" + Math.random().toString(36).substr(2, 9);
      }

      function formatInputNumber(input) {
        let value = input.value.replace(/[^0-9]/g, "");
        if (value) {
          input.value = parseInt(value).toLocaleString("id-ID");
        } else {
          input.value = "";
        }
      }

      function parseInputNumber(value) {
        return parseInt(value.replace(/[^0-9]/g, "")) || 0;
      }

      transactionForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const description = descriptionInput.value.trim();
        const amount = parseInputNumber(amountInput.value);
        const date = dateInput.value;
        let category =
          categoryInput.value.trim() || customCategoryInput.value.trim();

        if (!description || !amount || !date) {
          showMessage("Semua kolom wajib diisi!", "bg-red-600");
          return;
        }

        if (!category) {
          category =
            currentTransactionType === "income" ? "Pendapatan" : "Lain-lain";
        }

        if (!categories.includes(category)) {
          categories.push(category);
          saveData();
        }

        const transaction = {
          id: generateId(),
          type: currentTransactionType,
          description,
          amount,
          category,
          timestamp: new Date(date).toISOString(),
        };

        transactions.push(transaction);
        saveData();
        updateUI();
        showMessage(
          `Transaksi ${
            currentTransactionType === "income" ? "Pemasukan" : "Pengeluaran"
          } berhasil ditambahkan!`,
          "bg-green-600"
        );

        const funMessages = [
          "Wah, keuanganmu makin teratur! üí™",
          "Langkah kecil menuju tabungan besar! üê∑",
          "Keren, kamu tahu caranya kelola uang! üòé",
          "Tabunganmu bakal tersenyum lebar! üòÑ",
        ];
        showFunMessage(
          funMessages[Math.floor(Math.random() * funMessages.length)],
          "bg-indigo-600"
        );

        transactionForm.reset();
        categoryInput.value = "";
        customCategoryInput.value = "";
        updateCategorySuggestions(detectCategories(""));
      });

      amountInput.addEventListener("input", function () {
        formatInputNumber(this);
      });

      document
        .getElementById("savings-target")
        .addEventListener("input", function () {
          formatInputNumber(this);
        });

      document
        .getElementById("savings-amount")
        .addEventListener("input", function () {
          formatInputNumber(this);
        });

      document
        .getElementById("money-amount")
        .addEventListener("input", function () {
          formatInputNumber(this);
        });

      function showTab(tabId) {
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });
        document.querySelectorAll(".tab-button").forEach((button) => {
          button.classList.remove("active");
        });
        document.getElementById(`${tabId}-content`).classList.add("active");
        document
          .querySelector(`button[onclick="showTab('${tabId}')"]`)
          .classList.add("active");
      }

      function updateSavingsUI() {
        savingsList.innerHTML = "";
        if (savings.length === 0) {
          savingsList.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-coins"></i>
                <p>Belum Ada Celengan</p>
                <p class="text-sm mt-2">Mulai menabung dengan membuat celengan pertama Anda!</p>
            </div>
        `;
        } else {
          savings.forEach((saving) => {
            const progress = (saving.current / saving.target) * 100;
            const progressWidth = Math.min(progress, 100);
            const remainingDays = calculateRemainingDays(saving);
            const savingsCard = document.createElement("div");
            savingsCard.className = "savings-card";
            savingsCard.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold" style="color: var(--accent-yellow);">${
                      saving.name
                    }</h3>
                    <div class="flex gap-2">
                        <button class="add-money-btn" onclick="openAddMoneyModal('${
                          saving.id
                        }')">
                            <i class="fas fa-money-bill-wave mr-1"></i> Kelola
                        </button>
                        <button class="delete-savings-btn" onclick="deleteSavings('${
                          saving.id
                        }')">
                            <i class="fas fa-trash mr-1"></i> Hapus
                        </button>
                    </div>
                </div>
                <div class="savings-progress">
                    <div class="savings-progress-bar" style="width: ${progressWidth}%"></div>
                </div>
                <div class="flex justify-between text-sm mb-2">
                    <p>Terkumpul: <span class="font-bold">${formatNumber(
                      saving.current
                    )}</span></p>
                    <p>Target: <span class="font-bold">${formatNumber(
                      saving.target
                    )}</span></p>
                </div>
                <div class="savings-stats">
                    <div class="stat-item">
                        <div class="stat-value-sm">${
                          saving.plan.charAt(0).toUpperCase() +
                          saving.plan.slice(1)
                        }</div>
                        <p class="stat-label">Rencana</p>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value-sm">${formatNumber(
                          saving.amount
                        )}</div>
                        <p class="stat-label">Nominal ${saving.plan}</p>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value-sm">${remainingDays} hari</div>
                        <p class="stat-label">Sisa Waktu</p>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value-sm">${Math.round(
                          progress
                        )}%</div>
                        <p class="stat-label">Progres</p>
                    </div>
                </div>
            `;
            savingsList.appendChild(savingsCard);
          });
        }
      }

      function calculateRemainingDays(saving) {
        const startDate = new Date(saving.createdAt);
        const targetAmount = saving.target;
        const currentAmount = saving.current;
        const amountPerPlan = saving.amount;
        let planInterval;
        switch (saving.plan) {
          case "daily":
            planInterval = 1;
            break;
          case "weekly":
            planInterval = 7;
            break;
          case "monthly":
            planInterval = 30;
            break;
        }
        const remainingAmount = targetAmount - currentAmount;
        const remainingPlans = Math.ceil(remainingAmount / amountPerPlan);
        const remainingDays = remainingPlans * planInterval;
        return Math.max(0, remainingDays);
      }

      function openSavingsModal(editId = null) {
        editingSavingsId = editId;
        const modalTitle = document.getElementById("modal-title");
        if (editId) {
          const saving = savings.find((s) => s.id === editId);
          modalTitle.innerHTML = `<i class="fas fa-edit mr-2"></i>Edit Celengan`;
          document.getElementById("savings-name").value = saving.name;
          document.getElementById("savings-target").value =
            saving.target.toLocaleString("id-ID");
          document.getElementById("savings-amount").value =
            saving.amount.toLocaleString("id-ID");
          document.querySelectorAll(".savings-plan-btn").forEach((btn) => {
            btn.classList.remove("active");
            if (btn.dataset.plan === saving.plan) {
              btn.classList.add("active");
              currentSavingsPlan = saving.plan;
            }
          });
        } else {
          modalTitle.innerHTML = `<i class="fas fa-plus-circle mr-2"></i>Buat Celengan Baru`;
          savingsForm.reset();
          document.querySelectorAll(".savings-plan-btn").forEach((btn) => {
            btn.classList.remove("active");
            if (btn.dataset.plan === "daily") {
              btn.classList.add("active");
              currentSavingsPlan = "daily";
            }
          });
        }
        savingsModal.classList.remove("hidden");
      }

      function openAddMoneyModal(savingsId) {
        currentSavingsId = savingsId;
        const saving = savings.find((s) => s.id === savingsId);
        document.getElementById(
          "add-money-title"
        ).textContent = `Tambah/Kurangi Uang: ${saving.name}`;
        addMoneyForm.reset();
        document.querySelectorAll(".amount-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.dataset.action === "increase") {
            btn.classList.add("active");
            currentMoneyAction = "increase";
          }
        });
        addMoneyModal.classList.remove("hidden");
      }

      function deleteSavings(id) {
        savings = savings.filter((s) => s.id !== id);
        saveData();
        updateSavingsUI();
        showMessage("Celengan dihapus!", "bg-red-600");
      }

      addSavingsBtn.addEventListener("click", () => openSavingsModal());

      cancelSavings.addEventListener("click", () => {
        savingsModal.classList.add("hidden");
        savingsForm.reset();
      });

      cancelAddMoney.addEventListener("click", () => {
        addMoneyModal.classList.add("hidden");
        addMoneyForm.reset();
      });

      document.querySelectorAll(".savings-plan-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          document
            .querySelectorAll(".savings-plan-btn")
            .forEach((b) => b.classList.remove("active"));
          this.classList.add("active");
          currentSavingsPlan = this.dataset.plan;
        });
      });

      document.querySelectorAll(".amount-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
          document
            .querySelectorAll(".amount-btn")
            .forEach((b) => b.classList.remove("active"));
          this.classList.add("active");
          currentMoneyAction = this.dataset.action;
        });
      });

      savingsForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const name = document.getElementById("savings-name").value.trim();
        const target = parseInputNumber(
          document.getElementById("savings-target").value
        );
        const amount = parseInputNumber(
          document.getElementById("savings-amount").value
        );

        if (!name || !target || !amount) {
          showMessage("Semua kolom wajib diisi!", "bg-red-600");
          return;
        }

        if (editingSavingsId) {
          const saving = savings.find((s) => s.id === editingSavingsId);
          saving.name = name;
          saving.target = target;
          saving.amount = amount;
          saving.plan = currentSavingsPlan;
          showMessage("Celengan diperbarui!", "bg-green-600");
        } else {
          const saving = {
            id: generateId(),
            name,
            target,
            amount,
            plan: currentSavingsPlan,
            current: 0,
            createdAt: new Date().toISOString(),
            history: [],
          };
          savings.push(saving);
          showMessage("Celengan berhasil dibuat!", "bg-green-600");
        }

        saveData();
        updateSavingsUI();
        savingsModal.classList.add("hidden");
        savingsForm.reset();
      });

      addMoneyForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const amount = parseInputNumber(
          document.getElementById("money-amount").value
        );
        const description =
          document.getElementById("money-description").value.trim() ||
          "Tanpa keterangan";

        if (!amount) {
          showMessage("Jumlah wajib diisi!", "bg-red-600");
          return;
        }

        const saving = savings.find((s) => s.id === currentSavingsId);
        if (currentMoneyAction === "increase") {
          saving.current += amount;
          saving.history.push({
            action: "increase",
            amount,
            description,
            timestamp: new Date().toISOString(),
          });
          showMessage(
            `Berhasil menambahkan ${formatNumber(amount)} ke celengan!`,
            "bg-green-600"
          );
        } else {
          if (amount > saving.current) {
            showMessage(
              "Jumlah yang dikurangi melebihi saldo celengan!",
              "bg-red-600"
            );
            return;
          }
          saving.current -= amount;
          saving.history.push({
            action: "decrease",
            amount,
            description,
            timestamp: new Date().toISOString(),
          });
          showMessage(
            `Berhasil mengurangi ${formatNumber(amount)} dari celengan!`,
            "bg-red-600"
          );
        }

        saveData();
        updateSavingsUI();
        addMoneyModal.classList.add("hidden");
        addMoneyForm.reset();
      });

      document.addEventListener("DOMContentLoaded", () => {
        loadData();
        setupTypeButtons();
        setupAutoCategory();
        dateInput.value = new Date().toISOString().split("T")[0];
        updateCategorySuggestions(detectCategories(""));
      });
    </script>
  </body>
</html>
